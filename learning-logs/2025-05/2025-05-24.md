# Next.js App RouterでのAPIルート作成と型定義の共有 まとめ

## 1. App Router構成でのAPIエンドポイント
- APIエンドポイントは `src/app/api/xxx/route.ts` に作成する。
- `GET` や `POST` などの関数をエクスポートして、HTTPメソッドごとに処理を分ける。
- 例：
  ```ts
  // src/app/api/hello/route.ts
  import { NextResponse } from 'next/server';
  export async function GET() {
    return NextResponse.json({ message: 'Hello, API!' });
  }
  ```

## 2. 型定義の共有
- 型定義ファイル（例：`src/types/api.ts`）を作成し、APIのリクエスト・レスポンス型を定義する。
- APIルートとフロントエンド両方で同じ型をimportして使うことで、型安全な開発ができる。
- 例：
  ```ts
  // src/types/api.ts
  export type HelloResponse = { message: string };
  ```

## 3. フロントエンドからAPIを呼び出す
- fetchなどでAPIを呼び出し、型を活用して安全にデータを扱う。
- 例：
  ```ts
  import type { HelloResponse } from '@/types/api';
  async function fetchHello(): Promise<HelloResponse> {
    const res = await fetch('/api/hello');
    return res.json();
  }
  ```

## 4. フォルダ構成のポイント
- App Router構成では `pages/` ではなく `app/` ディレクトリを使う。
- APIルートは `app/api/` 配下に `route.ts` で作成する。

## 動的ルーティングとネストされたルート
- ディレクトリ名に`[id]`などを使うことで、動的なURLパラメータを受け取るページを作成できる。
- ネストされたルートはディレクトリを深くするだけで簡単に実現できる。
- 例：
  - `/jobs` → `src/app/jobs/page.tsx`
  - `/jobs/[id]` → `src/app/jobs/[id]/page.tsx`
  - `/jobs/[id]/edit` → `src/app/jobs/[id]/edit/page.tsx`
- `params`でURLパラメータを受け取れる。

## 実際のAPIとの連携
- サーバーコンポーネント内で`fetch`を使い、外部APIや自作APIからデータを取得できる。
- 例：
  ```ts
  const res = await fetch('https://jsonplaceholder.typicode.com/users', { cache: 'no-store' });
  const jobs: Job[] = await res.json();
  ```
- 詳細ページでは`params.id`を使って個別データを取得できる。

## fetchのcacheオプション
- `{ cache: 'no-store' }`：毎回新しいデータを取得（常に最新が必要な場合）
- `{ cache: 'force-cache' }`：キャッシュがあればそれを使う
- `{ next: { revalidate: 秒数 } }`：指定秒数ごとにキャッシュを再生成（ISR）
- 用途に応じて使い分けることで、パフォーマンスやデータ鮮度を調整できる。

---

### ここまでの学び
- App Router構成でのページ・APIルートの作成方法を理解した。
- 型定義の共有やpropsの受け渡し、動的ルーティングの実装方法を体験した。
- fetchのキャッシュ戦略や、実際のAPI連携の基礎も身についた。
